<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Player Profile</title>
  <link rel="icon" href="favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="favicon.png" sizes="180x180" />
  <meta name="theme-color" content="#005c41" />
  <!-- Ensure PapaParse is loaded first -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; }
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="index.html">Home</a> |
      <a href="profiles.html">All Players</a> |
      <a href="results.html">Results</a>
    </nav>
  </header>

  <h1>Player Profile</h1>
  <div id="profileHeader"></div>
  <div id="noData" style="display:none;">No data found for this player.</div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const params = new URLSearchParams(window.location.search);
      const playerName = decodeURIComponent(params.get('name') || '');
      const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ3rhIgmlvXGcinXjdJoAj0XxOuafX1POLtNBHnjFPUqDbvLqLpi4bvg9JwArglpspH50WnwU0lWhma/pub?output=csv';

      fetch(sheetUrl)
        .then(res => res.text())
        .then(csv => {
          const parsedData = Papa.parse(csv, { header: true, skipEmptyLines: true }).data;
          console.log('Fetched CSV Data:', parsedData); // Debugging the parsed data

          const recs = parsedData.filter(r => r.Name && r.Name.toLowerCase() === playerName.toLowerCase());
          if (!recs.length) {
            document.getElementById('noData').style.display = 'block';
            return;
          }

          const games = recs.length;
          const totalPoints = recs.reduce((sum, r) => sum + (parseFloat(r.Points) || 0), 0);
          const totalWinnings = recs.reduce((sum, r) => sum + (parseFloat(r.Winnings) || 0), 0);
          const trophies = recs.filter(r => parseInt(r.Position) === 1).length;

          document.getElementById('profileHeader').innerHTML = `
            <h2>${playerName}</h2>
            <ul>
              <li>Games: ${games}</li>
              <li>Total Points: ${totalPoints}</li>
              <li>Trophies: ${trophies}</li>
              <li>Winnings: Â£${totalWinnings.toFixed(2)}</li>
            </ul>
          `;
        })
        .catch(err => console.error('Error loading profile data:', err));
    });
  </script>
</body>
</html>
