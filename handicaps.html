<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Handicap History</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    #back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: #0066cc;
      text-decoration: none;
      font-weight: bold;
    }
    #back-link:hover {
      text-decoration: underline;
    }
    #chart-container {
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    canvas {
      width: 100% !important;
      height: auto !important;
    }
  </style>
</head>
<body>

<a id="back-link" href="index.html">&larr; Back to Main Table</a>
<h1>Player Handicap History</h1>

<div id="chart-container">
  <canvas id="handicapChart"></canvas>
</div>

<script>
  const excelFileUrl = 'YOUR_XLSX_FILE_URL_HERE'; // <-- CHANGE THIS to your actual .xlsx URL

  async function fetchAndProcessData() {
    const response = await fetch(excelFileUrl);
    const arrayBuffer = await response.arrayBuffer();
    const workbook = XLSX.read(arrayBuffer, { type: "array" });

    const sheetName = 'HandicapHistory'; // <-- your sheet name
    const sheet = workbook.Sheets[sheetName];
    const data = XLSX.utils.sheet_to_json(sheet);

    // Group data by player
    const players = {};
    data.forEach(row => {
      const player = row['Player'];
      const date = new Date(row['Date']);
      const handicap = parseFloat(row['Handicap']);
      if (!players[player]) players[player] = [];
      players[player].push({ date, handicap });
    });

    // Sort each player's history by date
    for (let player in players) {
      players[player].sort((a, b) => a.date - b.date);
    }

    return players;
  }

  function generateColors(count) {
    const colors = [];
    for (let i = 0; i < count; i++) {
      const r = Math.floor(Math.random() * 200);
      const g = Math.floor(Math.random() * 200);
      const b = Math.floor(Math.random() * 200);
      colors.push(`rgb(${r}, ${g}, ${b})`);
    }
    return colors;
  }

  async function createChart() {
    const players = await fetchAndProcessData();
    const ctx = document.getElementById('handicapChart').getContext('2d');

    const playerNames = Object.keys(players);
    const colors = generateColors(playerNames.length);

    const datasets = playerNames.map((player, index) => ({
      label: player,
      data: players[player].map(p => ({ x: p.date, y: p.handicap })),
      borderColor: colors[index],
      backgroundColor: colors[index],
      tension: 0.3,
      pointRadius: 4,
      pointHoverRadius: 6,
      fill: false,
    }));

    new Chart(ctx, {
      type: 'line',
      data: {
        datasets: datasets
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            type: 'time',
            time: {
              tooltipFormat: 'MMM dd, yyyy',
              unit: 'month'
            },
            title: {
              display: true,
              text: 'Date'
            }
          },
          y: {
            reverse: true, // <-- This flips the vertical axis (lower = cooler)
            title: {
              display: true,
              text: 'Handicap'
            },
            ticks: {
              precision: 1
            }
          }
        },
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                const date = new Date(context.parsed.x).toLocaleDateString();
                return `${context.dataset.label}: ${context.parsed.y} on ${date}`;
              }
            }
          },
          legend: {
            display: true,
            position: 'bottom',
          }
        }
      }
    });
  }

  createChart();
</script>

</body>
</html>
